# トランザクション分離レベル (Transaction Isolation Levels)

`SELECT @@transaction_isolation;` で確認できる MySQL (InnoDB) のトランザクション分離レベルは以下の4種類です。

## 1. READ UNCOMMITTED (未コミット読み取り)
- **特徴**: 他のトランザクションがまだコミットしていない変更（ダーティリード）を見ることができます。
- **問題点**: ダーティリード、ファントムリード、ノンリピータブルリードが発生する可能性があります。
- **一貫性**: 最も低い。

## 2. READ COMMITTED (コミット済み読み取り)
- **特徴**: コミットされた変更のみを見ることができます。
- **動作**: 同じトランザクション内でも、クエリを発行するたびに最新のコミット済みデータを読み取ります。
- **問題点**: ファントムリード、ノンリピータブルリードが発生する可能性があります。
- **採用例**: Oracle, PostgreSQL のデフォルト。

## 3. REPEATABLE READ (繰り返し読み取り)
- **特徴**: トランザクション開始時のスナップショットに基づいてデータを読み取ります（一貫性読み取り）。
- **動作**: 同じトランザクション内であれば、何度読み取っても同じ結果になります。
- **デフォルト**: MySQL (InnoDB) のデフォルト設定です。
- **問題点**: 理論上はファントムリードの可能性がありますが、InnoDBではネクストキーロックにより防がれています。

## 4. SERIALIZABLE (直列化可能)
- **特徴**: 最も厳しい分離レベル。トランザクションを完全に直列に実行しているかのように振る舞います。
- **動作**: 自動コミットが無効な場合、すべての `SELECT` 文が暗黙的に `SELECT ... FOR SHARE` に変換され、共有ロックがかかります。
- **一貫性**: 最も高いが、並行処理性能は最も低い。

## 読み取りの一貫性に関する問題 (Read Phenomena)

### ダーティリード (Dirty Read)
他のトランザクションが変更したが、まだコミットしていないデータを読み込んでしまう現象です。もしその変更がロールバックされた場合、存在しないデータを読み込んだことになります。

### ノンリピータブルリード (Non-repeatable Read)
1つのトランザクション内で同じデータを2回読み込んだ際に、その間に他のトランザクションがデータを更新・コミットしたため、1回目と2回目で値が異なってしまう現象です。

### ファントムリード (Phantom Read)
1つのトランザクション内で同じ条件で検索を行った際に、その間に他のトランザクションが新しい行を挿入・コミットしたため、1回目にはなかった行（幻影）が現れる現象です。

### ロストアップデート (Lost Update)
複数のトランザクションが同時に同じ行を読み込み、更新しようとした際に、後からコミットしたトランザクションが先のトランザクションの更新を上書きしてしまう現象です。「更新の紛失」とも呼ばれます。

### リードスキュー (Read Skew)
トランザクション内で複数のデータを読み込む際、その間に他のトランザクションがデータを更新・コミットしたため、データの整合性が取れない状態（例：合計値が合わないなど）を読み込んでしまう現象です。

---
現在の設定を確認するには:
```sql
SELECT @@transaction_isolation;
```
